<script src="asset/widget/common/js/jquery-3.3.1.min.js"></script>
<script src="basiscore.min.js"></script>
<script src="alasql.min.js"></script>
<input id="currentPage" type="hidden" value="{##db.next.value|(0)##}" />
{##db.next.value##}
<basis core="dbsource" source="trustloginuiapi" run="atclient" name="db" cache="refresh" pagecount="{##db.next.value##}"
    bc-trigger-on="db.next">
    <member name="wcalendar" type="list" request="calendar" preview=""></member>
</basis>
<basis core="dbsource" source="trustloginuiapi" run="atclient" name="db" pagecount="{##db.next.value##}"
    bc-trigger-on="db.next" cache="refresh">
    <member name="lastcalendar" type="list" request="calendar"
        postsql="select top 1 * from [db.lastcalendar] order by id desc" preview=""></member>
</basis>
<basis core="dbsource" source="trustloginuiapi" run="atclient" name="db" pagecount="{##db.next.value##}"
    bc-trigger-on="db.next" cache="refresh">
    <member name="firstcalendar" type="list" request="calendar" postsql="select top 1 * from [db.firstcalendar] "
        preview=""></member>
</basis>


<basis core="print" datamembername="db.firstcalendar" run="atclient" bc-rendered="calendarRendered">
    <face>
        <script type="text/template">
        <input type="hidden" value="@smonth@" id="smonth" />
    </script>
    </face>
</basis>
<script>
    var host = {
        Debug: false,
        AutoRender: false,
        settings: {
            'connection.web.callcommand': 'https://basispanel.ir/',
            // 'connection.web.callcommand': 'http://127.0.0.1:8080/',
            'connection.web.basiscoreapi': 'https://dbsource.basiscore.net/data.json',
            'connection.web.trustloginuiapi': 'https://dbsource.basiscore.net/data.json',
            'connection.web.trust_loginuiapi': 'https://dbsource.basiscore.net/data.json',
            'default.dbsource.verb': 'post',
            'default.call.verb': 'get',
            'default.viewCommand.groupColumn': 'prpid',
            'default.dmnid': '12',
            'default.binding.regex': '\\{##([^#]*)##\\}'
        }
    }



</script>
<script>

    $bc.setSource("db.next", 0);
    function calendarRendered(e) {
        console.log(e)
        $(".today").closest(".month").show()
        var wfirstday = $('#wfirstday').val()
        var wlastday = $('#wlastday').val()
        var week = $("#basisCalendar .calendar-body")
        var smonth = $(".sMonthVal #smonth").val()
        if (wfirstday <= 7) {
            switch (parseInt(wfirstday)) {
                case 7:
                    break;
                case 1:
                    week.prepend('<div class="sat day"></div>')
                    break;
                case 2:
                    week.prepend('<div class="sat day"></div><div class="sun day"></div>')
                    break;
                case 3:
                    week.prepend('<div class="sat day"></div><div class="sun day"></div><div class="mon day"></div>')
                    break;
                case 4:
                    week.prepend('<div class="sat day"></div><div class="sun day"></div><div class="mon day"></div><div class="tue day"></div>')
                    break;
                case 5:
                    week.prepend('<div class="sat day"></div><div class="sun day"></div><div class="mon day"></div><div class="tue day"></div><div class="wen day"></div>')
                    break;
                case 6:
                    week.prepend('<div class="sat day"></div><div class="sun day"></div><div class="mon day"></div><div class="tue day"></div><div class="wen day"></div><div class="tur day"></div>')
                    break;
            }
        }
        if (wlastday <= 7) {
            switch (parseInt(wlastday)) {
                case 7:
                    week.append('<div class="sun day"></div><div class="mon day"></div><div class="tue day"></div><div class="wen day"></div><div class="tur day"></div><div class="fri day"></div>')
                    break;
                case 1:
                    week.append('<div class="mon day"></div><div class="tue day"></div><div class="wen day"></div><div class="tur day"></div><div class="fri day"></div>')
                    break;
                case 2:
                    week.append('<div class="tue day"></div><div class="wen day"></div><div class="tur day"></div><div class="fri day"></div>')
                    break;
                case 3:
                    week.append('<div class="wen day"></div><div class="tur day"></div><div class="fri day"></div>')
                    break;
                case 4:
                    week.append('<div class="tur day"></div><div class="fri day"></div>')
                    break;
                case 5:
                    week.append('<div class="fri day"></div>')
                    break;
                case 6:
                    break;
            }
        }


        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                var res = JSON.parse(this.response)
                notes = res
                res.forEach(function (e) {
                    $('[data-id1="' + e.dateid + '"]').attr("data-show", true)
                    $('[data-id1="' + e.dateid + '"]').find(".noteList ul").append(`<li style="background:#${e.color}">${e.note}</li>`)
                })
            }
        };
        var data = `ownerid= 0&userid=122504&month=${smonth}&year=1400`
        xhr.open("POST", "https://api-ticketing.basiscore.com/777D20D5-5D4B-4BDA-B6FC-C97812265620/usernotes", true);
        xhr.send(data);
    }
</script>
<!-- <basis core="cookie" name="viewList" value="listStyle" path="/" />
<basis core="dbsource" source="trust_loginuiapi" run="atclient" name="shared" userid="122504" cache="none">
    <member name="files" type="list" request="sharedfiles" perpage="5" pageno="{##db.page.value|(1)##}"></member>
    <member name="paging" type="list" request="crmpaging" parentname="files" countp="4"></member>
</basis>


<div class="widget_wrapper" id="sharedWithMe">
    <div class="widget_title">
        <span>اشتراک با من</span>
        <div class="widget_buttons">
            <span class="delete_widget">
                <i class="lni lni-close"></i>
            </span>
        </div>
    </div>






    <div class="widget_body">


        <div class="responstable-box listStyle">

            <basis core="print" datamembername="shared.files" run="atclient">
                <else-layout>
                    <script type="text/template">
                            <tr>
                                <td colspan="6" class="empty_list">فایلی آپلود نکردید</td>
                            </tr>
                        </script>
                </else-layout>
                <layout>
                    <script type="text/template">
                                <table class="responstable sharedfiles listTable ">
                                    <tbody>
                                        <tr>
                                            <th class="col1" data-th="جزئیات">
                                                <span>
                                                    ردیف
                                                </span>
                                            </th>
                                            <th class="col5">
                                                <span>
                                                    <i class="icon-list"></i>
                                                    عنوان
                                                </span>
                                            </th>
                                            <th class="col5">
                                                <span>
                                                    <i class="icon-user"></i>
                                                    مالک فایل
                                                </span>
                                            </th>
                                            <th class="col2">
                                                <span>
                                                    <i class="icon-doc"></i>
                                                    حجم فایل
                                                </span>
                                            </th>
                                            <th class="col4">
                                                <span>
                                                    <i class="icon-calendar"></i>
                                                    تاریخ
                                                </span>
                                            </th>
                                            <th class="col1">
                                                <span>
                                                    <i class="icon-settings"></i>
                                                    عملیات
                                                </span>
                                            </th>
                                        </tr>
                            @child
                        </tbody>
                    </table>
                            </script>
                </layout>

                <face>
                    <script type="text/template">
                            <tr>
                                <td>@rownumber @rownumber>3?"hi":"low" </td>
                                <td class="title-box">
                                    <div class="">
                                        <img src="/images/typeUndefined.png" width="35" />
                                        <a class="title " href="/@path " target="_blank " download="@url " >@url </a>
                                    </div>
                                </td>
                                <td class="file-owner">
                                    <div>
                                        <span class="user"> @UserName.split('\u0040').join('\u0020') @rownumber%3 </span>
                                        <span class="name"> (@title ) </span>
                                    </div>
                                </td>
                                <td>
                                    @size B
                                </td>
                                <td>
                                    @date
                                </td>
                                <td>
                                    <div class="icons">
                                        <a class="download" data-tooltip="دانلود فایل" href="/@path " target="_blank" download="@url ">
                                            <i class="lni lni-cloud-download"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        </script>
                </face>

            </basis>


            <div class="clr"></div>
        </div>

        <div class="clr"></div>
    </div>
    <div class="pagination">
        <ul class="paging">


        </ul>

        <div class="clr"></div>
    </div>
</div>
<script>
    var host = {
        Debug: false,
        AutoRender: false,
        settings: {
            // 'connection.web.callcommand': '',
            'connection.web.callcommand': 'http://127.0.0.1:8080/',
            'connection.web.basiscoreapi': 'https://dbsource.basiscore.net/data.json',
            'connection.web.trustloginuiapi': 'https://dbsource.basiscore.net/data.json',
            'connection.web.trust_loginuiapi': 'https://dbsource.basiscore.net/data.json',
            'default.dbsource.verb': 'post',
            'default.call.verb': 'get',
            'default.viewCommand.groupColumn': 'prpid',
            'default.dmnid': '12',
            'default.binding.regex': '\\{##([^#]*)##\\}'
        }
    }

</script> -->