<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/basiscore.min.js"></script>
    <title>Print Command - Simple</title>
</head>

<body>
    <fieldset>
        <legend>Orginal</legend>
        <Basis core="print" datamembername="inlinesource.print" run="atclient" bc-pre-process="">
            <face>
                <span>@id ( @name ) </span>
                <br />
            </face>
        </Basis>
    </fieldset>
    <fieldset>
        <legend>Update</legend>
        <Basis core="print" datamembername="inlinesource.print" run="atclient" bc-pre-process="update">
            <face>
                <span>@id ( @name ) </span>
                <br />
            </face>
        </Basis>
    </fieldset>
    <fieldset>
        <legend>Change</legend>
        <Basis core="print" datamembername="inlinesource.print" run="atclient" bc-pre-process="change">
            <face>
                <span>@id ( @name ) </span>
                <br />
            </face>
        </Basis>
    </fieldset>
    <fieldset>
        <legend>Filter</legend>
        <Basis core="print" datamembername="inlinesource.print" run="atclient" bc-pre-process="filter">
            <face>
                <span>@id ( @name ) </span>
                <br />
            </face>
        </Basis>
    </fieldset>
    <fieldset>
        <legend>Dynamic</legend>
        <Basis core="print" datamembername="inlinesource.print" run="atclient" bc-pre-process="dynamic">
            <face>
                <span>@id ( @name ) </span>
                <br />
            </face>
        </Basis>
    </fieldset>
    <script>
        const host = {
            sources: {
                'inlinesource.print': [
                    { id: 1, name: 'data#1' },
                    { id: 2, name: 'data#2' },
                    { id: 3, name: 'data#3' },
                    { id: 4, name: 'data#4' },
                    { id: 5, name: 'data#5' },
                    { id: 6, name: 'data#6' },
                ],
                'inlinesource.print1': [
                    { id: 11, name: 'data#1-1' },
                    { id: 21, name: 'data#1-1' },
                    { id: 31, name: 'data#1-1' }
                ]
            }
        }

        function update(source, context) {
            const newSource = $bc.util.clone(source);
            newSource.data.rows.forEach(row => {
                row.id += 100;
                row.name = `new ${row.name}`
            });
            return newSource;
        }

        async function change(source, context) {
            return await context.waitToGetSourceAsync('inlinesource.print1');
        }

        function filter(source, context) {
            const rows = source.data.rows.filter(x => x.id > 3)
            const newSource = $bc.util.source.new('inlinesource.print2', rows)
            return newSource;
        }

        function dynamic(source, context) {
            return $bc.util.source.new('inlinesource.print2', [{ id: 301, name: 'Dynamic-data#1' }, { id: 302, name: 'Dynamic-data#2' }])
        }
    </script>
</body>

</html>